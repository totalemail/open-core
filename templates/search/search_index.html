{% extends 'totalemail/base.html' %}

{% block title %}TotalEmail Search: {{ q|truncatechars:42 }}{% endblock %}

{% block content %}

<!-- TODO: make the space from the top dynamic based on the size of the screen... also do this on the importer-index and other importer page. -->
<br>

<div class="text-center row">
    <h1>Search the Emails</h1>
    <br>

    {% if messages %}
        {% for message in messages %}
            {% autoescape off %}
                <span{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</span>
                <br>
            {% endautoescape %}
        {% endfor %}
        <br>
    {% endif %}

    <form action="{% url 'search:index' %}" method="get">
        <input id="searchBox" type="text" placeholder="Search for something here..." name="q" value="{{ q }}">
        <input class="hollow medium button success" type="submit" value="Search">
        {% if q != None %}
            <a class="hollow medium button secondary" href="{% url 'search:index' %}">Clear</a>
        {% endif %}
    </form>

    <span><i>Searching {{ total_email_count }} email{{ total_email_count|pluralize }}</i></span>

    <br><br>

    <div class="large-7 medium-7 small-7 float-center">
        {% if results %}
            {% if total_result_count > max_results %}
                <!-- TODO: Add a tooltip to this message explaining why we are limiting the results -->
                Showing {{ results|length }} of {{ total_result_count }} emails matching "{{ q }}":
            {% else %}
                Found {{ results|length }} email{{ results|length|pluralize }} matching "{{ q }}":
            {% endif %}
            <br><br>
            <ul>
            {% for email in results %}
                <li><a href="{% url 'details:details' email.id %}" target="_blank">{{ email.header.subject }}</a></li>
            {% endfor %}
            </ul>
        {% else %}
            {% if q != None %}
                No results found for "{{ q }}"
            {% endif %}
            <script>
                window.onload = function() {
                    window.setTimeout(function() {
                        $('#searchBox').click();
                    }, 100);
                }
            </script>
            <br>
        {% endif %}
    </div>

    <br><hr><br>

    <div class="large-6 medium-7 float-center">
        <h4>Search Prefixes</h4>
        <p>Every search can be prefixed with one of the values below to specify where you would like to find a specific value:</p>

        <ul style="list-style: none;">
            <li><i><b>sub</b>({subject})</i> - Search for emails with the given subject<p>(e.g. <a href="{% url 'search:index' %}?q=sub(spam)">sub(spam)</a>, <a href="{% url 'search:index' %}?q=sub(talk to)">sub(talk to)</a>)</p></li>
            <li><i><b>to</b>({recipient address/name})</i> - Search for emails with the given recipient address<p>(e.g. <a href="{% url 'search:index' %}?q=to(redacted)">to(redacted)</a>)</p></li>
            <li><i><b>from</b>({sending address/name})</i> - Search for emails with the given sending address<p>(e.g. <a href="{% url 'search:index' %}?q=from(tulip.ocn.ne.jp)">from(tulip.ocn.ne.jp)</a>, <a href="{% url 'search:index' %}?q=from(Fedex.shipping@ikexpress.com)">from(Fedex.shipping@ikexpress.com)</a>, <a href="{% url 'search:index' %}?q=from(Thank You)">from(Thank You)</a>)</p></li>
            <li><i><b>bod</b>({text})</i> - Search for emails with the given text in the body<p>(e.g. <a href="{% url 'search:index' %}?q=bod(money)">bod(money)</a>, <a href="{% url 'search:index' %}?q=bod(good day)">bod(good day)</a>)</p></li>
            <li><i><b>dom</b>({domain name})</i> - Search for emails with the given domain name<p>(e.g. <a href="{% url 'search:index' %}?q=dom(tulip.ocn.ne.jp)">dom(tulip.ocn.ne.jp)</a>)</p></li>
            <li><i><b>domh</b>({domain name})</i> - Search for emails with the given domain name in the header<p>(e.g. <a href="{% url 'search:index' %}?q=domh(tulip.ocn.ne.jp)">domh(tulip.ocn.ne.jp)</a>)</p></li>
            <li><i><b>domb</b>({domain name})</i> - Search for emails with the given domain name in a body<p>(e.g. <a href="{% url 'search:index' %}?q=domb(bit.ly)">domb(bit.ly)</a>)</p></li>
        </ul>
    </div>
</div>

<script>
    window.onload = function() {
        $(document).foundation();
    }
</script>

{% endblock %}
